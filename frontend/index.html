<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Créer une Tâche</title>
</head>
<body>
  <h1>Créer une nouvelle tâche</h1>
  <form id="taskForm">
    <label>Thème :
      <input type="text" name="theme" />
    </label><br><br>

    <label>Description*:
      <input type="text" name="description" required />
    </label><br><br>

    <label>Priorité :
      <select name="priorite">
        <option value="">--Choisir--</option>
        <option value="basse">Basse</option>
        <option value="moyenne">Moyenne</option>
        <option value="haute">Haute</option>
      </select>
    </label><br><br>

    <label>Terminée :
      <input type="checkbox" name="completed" />
    </label><br><br>

    <button type="submit">Créer</button>
  </form>

  <h2>Liste des tâches</h2>
  <ul id="taskList"></ul>

  <h2>Tâches completées</h2>
  <p id="taskRatio">Ratio : </p>
  <p id="taskInProgress"></p>


  <script>

  const form = document.getElementById("taskForm");
  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    const formData = new FormData(form);
    const json = {
      theme: formData.get("theme"),
      description: formData.get("description"),
      completed: formData.get("completed") === "on",
      priorite: formData.get("priorite"),
    };
    console.log(json)
    try {
      const response = await fetch("http://127.0.0.1:8000/tasks/create", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify(json),
      });

      const result = await response.json();
      console.log("Réponse du serveur :", result);
    } catch (error) {
      console.error("Erreur lors de l'envoi :", error);
    }
  });

    
  window.addEventListener("DOMContentLoaded", async () => {
    try {
      const response = await fetch("http://127.0.0.1:8000/tasks/list", {
        method: "GET",
        headers: {
          "Content-Type": "application/json",
        },
      });

      const tasks = await response.json();

      const taskList = document.getElementById("taskList");

      tasks.forEach((task) => {
        const li = document.createElement("li");
        li.textContent = `${task.theme ?? "Sans thème"} - ${task.description} (${task.priorite ?? "pas de priorité"})`;
        taskList.appendChild(li);
      });
    } catch (error) {
      console.error("Erreur lors du chargement des tâches :", error);
    }
  });




  window.addEventListener("DOMContentLoaded", async () => {
    try {
      const response = await fetch("http://127.0.0.1:8000/tasks/taux", {
        method: "GET",
        headers: {
          "Content-Type": "application/json",
        },
      });

      const ratio = await response.json();

      const taskRatio = document.getElementById("taskRatio");


      const p = document.createElement("p");
      p.textContent = `${ratio.message}`;
      taskRatio.appendChild(p);
      
    } catch (error) {
      console.error("Erreur lors du chargement des tâches :", error);
    }
  });

  window.addEventListener("DOMContentLoaded", async () => {
    try {
      const response = await fetch("http://127.0.0.1:8000/tasks/completer", {
        method: "GET",
        headers: {
          "Content-Type": "application/json",
        },
      });

      const done = await response.json();

      const taskDone = document.getElementById("taskInProgress");


      const p = document.createElement("p");
      p.textContent = `${done.message}`;
      taskDone.appendChild(p);
      
    } catch (error) {
      console.error("Erreur lors du chargement des tâches :", error);
    }
  });

</script>

</body>
</html>